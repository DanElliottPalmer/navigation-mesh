<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class=""> <!--<![endif]-->
	<head>  
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<canvas id="domCanvas" width="800" height="400" style="border: 1px solid #f00"></canvas> <br />
		<textarea cols="50" rows="10" id="txtInput">{"neighbours":[[20,1],[2,0],[3,1],[4,2],[5,3],[6,4],[5,29,7],[23,6,8],[7,9],[10,8],[11,9],[10,12],[24,13,11],[12,14],[13,15],[16,14],[15,17],[16,18],[22,17,19],[18,21,20],[19,0],[19],[23,18],[7,22],[26,25,12],[24],[24,27],[26,28],[27,29],[6,28]],"points":[[70,346],[118,168],[163,294],[77,59],[110,123],[117,85],[216,84],[440,36],[376,77],[300,141],[375,128],[437,182],[604,134],[498,247],[636,382],[467,382],[440,276],[266,289],[382,205],[293,205],[228,160],[260,372],[744,179],[768,343],[615,100],[411,65]],"triangles":[[0,1,2],[1,0,3],[1,3,4],[4,3,5],[5,3,6],[3,7,6],[8,6,7],[8,9,6],[10,9,8],[9,10,11],[11,10,12],[13,11,12],[13,12,14],[15,13,14],[15,16,13],[15,17,16],[18,16,17],[17,19,18],[17,20,19],[2,20,17],[2,1,20],[21,2,17],[19,20,9],[20,6,9],[14,12,22],[14,22,23],[12,24,22],[12,7,24],[25,7,12],[25,8,7]]}</textarea>
		<button id="btnParse">Parse</button>
		<button id="btnGraph">Render graph</button>
		<script src="dist/NavigationMesh.js"></script>
		<script type="text/javascript">

			var renderer = new Renderer( document.getElementById("domCanvas") );
			renderer.on("click", function( e ){
				var node = mesh.graph.containsPoint( e.offsetX, e.offsetY );
				mesh.triangles.forEach(function(triangle){
					triangle.stroke = "#f00";
				});
				if( !node ) return;
				node.triangle.stroke = "#00f";
				renderGraph();
			});

			var stage = new Stage();
			renderer.stage = stage;

			var mesh = null;

			document.getElementById("btnParse").addEventListener("click", function(){
				mesh = new NavigationMesh();
				mesh.parse( JSON.parse( document.getElementById("txtInput").value ) );
				stage.addChild( mesh.triangles );
				renderer.render();
			});


			/**
			 * DEBUG RENDER BITS
			 */

			function renderGraph(){
				renderer.clear();
				renderer.render();

				var graph = mesh.graph;
				var neighbour;
				var circle = new Circle(0,0,4);
				circle.fill = "#0f0";
				var link = new Line( 0, 0, 0, 0 );
				link.stroke = "#00f";
				graph.nodes.forEach(function( node ){
					// Node
					circle.cx = node.x;
					circle.cy = node.y;
					circle.render( renderer.ctx );	
					// Links
					node.neighbours.forEach(function( index ){
						neighbour = graph.nodes[ index ];
						link.x1 = node.x;
						link.y1 = node.y;
						link.x2 = neighbour.x;
						link.y2 = neighbour.y;
						link.render( renderer.ctx );
					});
				});

			}
			document.getElementById("btnGraph").addEventListener("click", renderGraph);



		</script>
	</body>
</html>